#!/bin/bash

# Ensure metrics server is enabled for kubectl top
minikube addons enable metrics-server

# Scale the deployment to 3 replicas
kubectl scale deployment messaging-app --replicas=3

# Verify that multiple pods are running
kubectl get pods

# Give it a moment to scale (optional, can simulate with sleep)
sleep 5

# Perform load testing using wrk
# Accessing the service via minikube
URL=$(minikube service messaging-app --url)
echo "Load testing against $URL"
wrk -t12 -c400 -d30s $URL

# Monitor Resource Usage
kubectl top pods
